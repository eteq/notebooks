language: python

env:
  global:
    - CONDA_CHANNELS='astropy-ci-extras astropy http://ssb.stsci.edu/astroconda'
    - CONDA_DEPENDENCIES="astropy scipy astroquery matplotlib jupyter pandas drizzlepac crds"
    - PYTHON_VERSION=3.6

jobs:
  include:
    - name: run/convert notebooks
      script: python convert.py
    - name: check notebooks
      script: python -m "nbpages.check_nbs" --commit-range="${TRAVIS_COMMIT_RANGE/.../..}"  # see https://github.com/travis-ci/travis-ci/issues/4596 for why this bit in TRAVIS_COMMIT_RANGE is necessary
    - stage: deploy
      if: type != "pull_request" AND branch = "master"
      script: python convert.py
      deploy:
        provider: script
        script: deploy.sh
        skip-cleanup: true

install:
    - git clone git://github.com/astropy/ci-helpers.git
    - source ci-helpers/travis/setup_conda.sh
    - pip install git+https://github.com/eteq/nbpages.git#egg=nbpages
    - pip install --pre astroquery
